(function(e){function t(t){for(var a,s,o=t[0],l=t[1],r=t[2],h=0,p=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&p.push(i[s][0]),i[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(p.length)p.shift()();return c.push.apply(c,r||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,o=1;o<n.length;o++){var l=n[o];0!==i[l]&&(a=!1)}a&&(c.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},i={app:0},c=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/guess-the-scale/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var r=0;r<o.length;r++)t(o[r]);var u=l;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("7a23"),i={id:"app"},c=Object(a["f"])("h1",null,"Guess the scale?",-1),s=Object(a["f"])("footer",null,[Object(a["f"])("small",null,[Object(a["e"])(" Made by "),Object(a["f"])("a",{href:"https://github.com/indutny/guess-the-scale",target:"_blank"}," @indutny ")])],-1);function o(e,t,n,o,l,r){var u=Object(a["k"])("Player");return Object(a["g"])(),Object(a["c"])("div",i,[c,Object(a["f"])(u),s])}n("b0c0");var l=Object(a["r"])("data-v-15365caa");Object(a["i"])("data-v-15365caa");var r={class:"player"},u={class:"score"},h={key:0},p={key:0},b={key:1},f={key:2,class:"guessing"},m={class:"row"},d={class:"row"},y={key:3,class:"wrong"},O={key:0},g=Object(a["f"])("p",null,"Sorry, but you got it wrong. It was",-1),j={class:"expected"},v=Object(a["e"])(" (and sadly not "),S={class:"actual"},k=Object(a["e"])(") "),w={key:1},x=Object(a["f"])("p",null,"It was",-1),C={class:"config"},M={key:0},T={class:"scale-list"},P={class:"gain"},A=Object(a["e"])(" Gain: "),V=Object(a["f"])("br",null,null,-1),N={class:"melody"},q=Object(a["e"])(" Melody: "),J=Object(a["f"])("br",null,null,-1),G={class:"bpm"},_=Object(a["e"])(" BPM: "),R=Object(a["f"])("br",null,null,-1);Object(a["h"])();var U=l((function(e,t,n,i,c,s){var o=Object(a["l"])("focus");return Object(a["g"])(),Object(a["c"])("div",r,[Object(a["f"])("h3",u,[Object(a["e"])(" Score: "+Object(a["m"])(c.score)+" ",1),1!==c.multiplier?(Object(a["g"])(),Object(a["c"])("span",h,"(x"+Object(a["m"])(c.multiplier)+")",1)):Object(a["d"])("",!0),Object(a["e"])(" / Best score: "+Object(a["m"])(c.best),1)]),s.hitPercent?(Object(a["g"])(),Object(a["c"])("h4",p,"You got: "+Object(a["m"])(s.hitPercent)+" right!",1)):Object(a["d"])("",!0),"idle"===c.state?(Object(a["g"])(),Object(a["c"])("span",b,[Object(a["p"])(Object(a["f"])("button",{class:"start",onClick:t[1]||(t[1]=Object(a["q"])((function(){return s.onStart.apply(s,arguments)}),["prevent"]))},"Start",512),[[o]])])):"guessing"===c.state?(Object(a["g"])(),Object(a["c"])("span",f,[Object(a["f"])("form",{onSubmit:t[5]||(t[5]=Object(a["q"])((function(){return s.onGuess.apply(s,arguments)}),["prevent"]))},[Object(a["f"])("div",m,[Object(a["p"])(Object(a["f"])("input",{autofocus:"","onUpdate:modelValue":t[2]||(t[2]=function(e){return c.guess=e}),class:"guess",placeholder:"Scale name"},null,512),[[o],[a["o"],c.guess]]),Object(a["f"])("input",{type:"submit",disabled:!s.matchedScale,value:"Check"},null,8,["disabled"])]),Object(a["f"])("div",d,[Object(a["f"])("button",{class:"repeat",onClick:t[3]||(t[3]=Object(a["q"])((function(){return s.onRepeat.apply(s,arguments)}),["prevent"]))},"Play Again"),Object(a["f"])("button",{class:"skip",onClick:t[4]||(t[4]=Object(a["q"])((function(){return s.onSkip.apply(s,arguments)}),["prevent"]))},"Skip")])],32)])):(Object(a["g"])(),Object(a["c"])("span",y,[s.matchedScale?(Object(a["g"])(),Object(a["c"])("span",O,[g,Object(a["f"])("p",null,[Object(a["f"])("b",j,Object(a["m"])(c.scale),1),v,Object(a["f"])("b",S,Object(a["m"])(s.matchedScale),1),k])])):(Object(a["g"])(),Object(a["c"])("span",w,[x,Object(a["f"])("p",null,[Object(a["f"])("b",null,Object(a["m"])(c.scale),1)])])),Object(a["p"])(Object(a["f"])("button",{class:"repeat",onClick:t[6]||(t[6]=Object(a["q"])((function(){return s.onStart.apply(s,arguments)}),["prevent"]))}," Next Scale ",512),[[o]])])),Object(a["f"])("div",C,[Object(a["f"])("h4",{onClick:t[7]||(t[7]=Object(a["q"])((function(){return s.onToggleConfig.apply(s,arguments)}),["prevent"]))},"[Configuration]"),c.showConfig?(Object(a["g"])(),Object(a["c"])("div",M,[Object(a["f"])("section",T,[(Object(a["g"])(!0),Object(a["c"])(a["a"],null,Object(a["j"])(s.scaleGroups,(function(e){return Object(a["g"])(),Object(a["c"])("div",{class:"scale-column",key:e.name},[(Object(a["g"])(!0),Object(a["c"])(a["a"],null,Object(a["j"])(e.scales,(function(e){return Object(a["g"])(),Object(a["c"])("div",{class:"scale",key:e},[Object(a["f"])("label",null,[Object(a["p"])(Object(a["f"])("input",{type:"checkbox",onChange:function(t){return s.onToggleScale(e.name)},"onUpdate:modelValue":function(t){return e.active=t}},null,40,["onChange","onUpdate:modelValue"]),[[a["n"],e.active]]),Object(a["e"])(" "+Object(a["m"])(e.name),1)]),Object(a["f"])("button",{onClick:Object(a["q"])((function(t){return s.onPlayScale(e.name)}),["prevent"])},"Play",8,["onClick"])])})),128))])})),128))]),Object(a["f"])("section",P,[Object(a["f"])("label",null,[A,V,Object(a["p"])(Object(a["f"])("input",{type:"range","onUpdate:modelValue":t[8]||(t[8]=function(e){return c.gain=e}),onChange:t[9]||(t[9]=function(){return s.persist.apply(s,arguments)}),min:"0.01",max:"0.5",step:"0.01"},null,544),[[a["o"],c.gain]])])]),Object(a["f"])("section",N,[Object(a["f"])("label",null,[q,J,Object(a["p"])(Object(a["f"])("input",{"onUpdate:modelValue":t[10]||(t[10]=function(e){return c.melody=e}),onChange:t[11]||(t[11]=function(){return s.persist.apply(s,arguments)}),placeholder:"1,2,3,4,5,6,7,8"},null,544),[[a["o"],c.melody]])])]),Object(a["f"])("section",G,[Object(a["f"])("label",null,[_,R,Object(a["p"])(Object(a["f"])("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=function(e){return c.bpm=e}),onChange:t[13]||(t[13]=function(){return s.persist.apply(s,arguments)}),placeholder:"120"},null,544),[[a["o"],c.bpm]])])])])):Object(a["d"])("",!0)])])})),I=(n("4de4"),n("7db0"),n("a630"),n("d81d"),n("b680"),n("d3b7"),n("3ca3"),n("2ca0"),n("ddb0"),n("3835")),L=n("b85c"),z=(n("4ec9"),n("ac1f"),n("1276"),n("d4ec")),B=n("bee2"),D=n("5530"),F=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"square",a=arguments.length>2?arguments[2]:void 0;Object(z["a"])(this,e),this.options=Object(D["a"])({gain:{},filter:{}},a),this.options={gain:Object(D["a"])({attack:.001,sustain:2,release:.05},this.options.gain),filter:Object(D["a"])({ground:1e3,attack:{time:0,value:7e3},sustain:{time:5,value:6e3},release:{time:.2}},this.options.filter)},this.osc=t.createOscillator(),this.osc.type=n,this.filter=t.createBiquadFilter(),this.filter.type="lowpass",this.gain=t.createGain(),this.gain.gain.setValueAtTime(0,t.currentTime),this.osc.connect(this.filter),this.filter.connect(this.gain),this.osc.start()}return Object(B["a"])(e,[{key:"connect",value:function(e){this.gain.connect(e)}},{key:"envelope",value:function(e,t,n,a){var i=a.ground,c=a.attack,s=a.sustain,o=a.release;e.cancelScheduledValues(t),e.linearRampToValueAtTime(i,t);var l=Math.min(n,c.time);t+=l,n=Math.max(0,n-l),e.linearRampToValueAtTime(c.value,t),l=Math.min(n,s.time),t+=l,n=Math.max(0,n-l),e.linearRampToValueAtTime(s.value,t),t+=n,n=0,e.linearRampToValueAtTime(s.value,t),t+=o.time,e.linearRampToValueAtTime(i,t)}},{key:"play",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:440,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.gain,i=void 0===a?.2:a,c=n.duration,s=void 0===c?.25:c;return this.osc.frequency.cancelScheduledValues(e),this.osc.frequency.setValueAtTime(t,e),this.envelope(this.gain.gain,e,s,{ground:0,attack:{time:this.options.gain.attack,value:i},sustain:{time:this.options.gain.sustain,value:.75*i},release:{time:this.options.gain.release}}),this.envelope(this.filter.frequency,e,s,this.options.filter),e+s+this.options.gain.release}},{key:"stop",value:function(e){this.gain.gain.cancelScheduledValues(e),this.gain.gain.linearRampToValueAtTime(0,e)}}]),e}(),H=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type,i=n.voices,c=void 0===i?8:i;Object(z["a"])(this,e),this.context=t,this.voices=[];for(var s=0;s<c;s++)this.voices.push({osc:new F(t,a),freeAt:t.currentTime})}return Object(B["a"])(e,[{key:"connect",value:function(e){var t,n=Object(L["a"])(this.voices);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.osc.connect(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"play",value:function(t,n,a){var i=this.voices[0],c=110*Math.pow(2,(3+n)/12);i.freeAt=i.osc.play(t,c,a),this.voices.sort(e.voiceCompare)}},{key:"stop",value:function(e){var t,n=Object(L["a"])(this.voices);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.osc.stop(e)}}catch(i){n.e(i)}finally{n.f()}}}],[{key:"voiceCompare",value:function(e,t){return e.freeAt-t.freeAt}}]),e}(),W=new Map;function Y(e,t,n){W.set(e,{type:t,notes:n})}Y("Ionian/Major","maj",[0,2,4,5,7,9,11]),Y("Mixolydian","maj",[0,2,4,5,7,9,10]),Y("Lydian","maj",[0,2,4,6,7,9,11]),Y("Phrygian","min",[0,1,3,5,7,8,10]),Y("Locrian","min",[0,1,3,5,6,8,10]),Y("Melodic minor","min",[0,2,3,5,7,9,11]),Y("Aeolian/Natural minor","min",[0,2,3,5,7,8,10]),Y("Dorian","min",[0,2,3,5,7,9,10]),Y("Harmonic minor","min",[0,2,3,5,7,8,11]);var E=function(){function e(){Object(z["a"])(this,e);var t=window.AudioContext||window.webkitAudioContext;this.context=new t,this.harmony=new H(this.context,{type:"triangle"}),this.melody=new H(this.context),this.gain=this.context.createGain(),this.gain.gain.setValueAtTime(1,this.context.currentTime),this.harmony.connect(this.gain),this.melody.connect(this.gain),this.compressor=this.context.createDynamicsCompressor(),this.gain.connect(this.compressor),this.compressor.connect(this.context.destination),this.compressor.threshold.value=-1,this.compressor.attack.value=.001,this.compressor.release.value=.05,this.compressor.ratio.value=1e3}return Object(B["a"])(e,[{key:"setGain",value:function(e){this.gain.gain.setValueAtTime(e,this.context.currentTime)}},{key:"note",value:function(e,t,n){var a=0;while(n>=7)a++,n-=7;while(n<0)a--,n+=7;return t+e[n%7]+12*a}},{key:"parseMelody",value:function(e){var t,n=e.toLowerCase().split(/[^r\d+]/g).filter((function(e){return e})).map((function(e){return"r"===e?"rest":parseInt(e,10)-1})),a=[],i=Object(L["a"])(n);try{for(i.s();!(t=i.n()).done;){var c=t.value,s=a[a.length-1];s&&s.note===c?s.duration++:a.push({note:c,duration:1})}}catch(o){i.e(o)}finally{i.f()}return a}},{key:"playScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.base,a=t.melody,i=void 0===a?"1,2,3,4,5,6,7,8":a,c=t.bpm,s=void 0===c?120:c,o=this.context.currentTime,l=60/s/2,r=0;i=this.parseMelody(i);var u=W.get(e).notes;void 0===n&&(n=Math.floor(12*Math.random())),this.harmony.stop(o),this.melody.stop(o);var h,p=Object(L["a"])(i);try{for(p.s();!(h=p.n()).done;){var b=h.value,f=b.note,m=b.duration;"rest"!==f&&this.melody.play(o+r,this.note(u,n,7+f),{gain:.5,duration:m*l}),r+=m*l}}catch(y){p.e(y)}finally{p.f()}var d={gain:.7,duration:r};return this.harmony.play(o,this.note(u,n,-7),d),this.harmony.play(o,this.note(u,n,0),d),this.harmony.play(o,this.note(u,n,2),d),{base:n}}},{key:"close",value:function(){this.context.close()}}]),e}(),K={name:"Player",data:function(){var e,t=[],n=Object(L["a"])(W);try{for(n.s();!(e=n.n()).done;){var a=Object(I["a"])(e.value,2),i=a[0],c=a[1].type;t.push({type:c,name:i,active:!0})}}catch(s){n.e(s)}finally{n.f()}return{player:null,scales:t,gain:.125,melody:"1,2,3,4,5,6,7,8",bpm:120,showConfig:!1,state:"idle",score:0,hits:0,total:0,best:0,streak:0,multiplier:1,scale:null,base:null,guess:""}},mounted:function(){var e=this;if(localStorage.scales){var t,n=Object(L["a"])(JSON.parse(localStorage.scales));try{var a=function(){var n=Object(I["a"])(t.value,2),a=n[0],i=n[1],c=e.scales.find((function(e){return e.name===a}));c.active=!!i};for(n.s();!(t=n.n()).done;)a()}catch(i){n.e(i)}finally{n.f()}}localStorage.best&&(this.best=JSON.parse(localStorage.best)),localStorage.gain&&(this.gain=JSON.parse(localStorage.gain)),localStorage.melody&&(this.melody=JSON.parse(localStorage.melody)),localStorage.bpm&&(this.bpm=JSON.parse(localStorage.bpm))},unmounted:function(){this.player&&this.player.close()},computed:{hitPercent:function(){return 0===this.total?"":(this.hits/this.total*100).toFixed(1)+"%"},scaleGroups:function(){var e=this;return["maj","min"].map((function(t){var n,a=[],i=Object(L["a"])(e.scales);try{for(i.s();!(n=i.n()).done;){var c=n.value;c.type===t&&a.push(c)}}catch(s){i.e(s)}finally{i.f()}return{name:t,scales:a}}))},scaleNames:function(){return Array.from(W.keys())},selectedScales:function(){return this.scales.filter((function(e){return e.active}))},matchedScale:function(){var e=this.guess.toLowerCase();/^ma/.test(e)?e="ionian":/^min/.test(e)&&(e="aeolian");var t=this.scaleNames.filter((function(t){return t.toLowerCase().startsWith(e)}));return 1!==t.length?null:t[0]}},watch:{gain:function(e){this.player&&this.player.setGain(e)}},methods:{onStart:function(){var e;this.state="guessing",this.guess="",this.scale=this.selectedScales[Math.random()*this.selectedScales.length|0].name;do{e=Math.floor(12*Math.random())-6}while(e===this.base);this.base=e,this.lazyPlayer().playScale(this.scale,{base:this.base,bpm:this.bpm,melody:this.melody})},onRepeat:function(){this.lazyPlayer().playScale(this.scale,{base:this.base,bpm:this.bpm,melody:this.melody})},onSkip:function(){this.state="skip"},onGuess:function(){this.matchedScale===this.scale?(this.score+=100*this.multiplier,this.hits++,this.best=Math.max(this.best,this.score),this.streak+=1,this.onStart()):(this.score=Math.max(this.score-75,0),this.streak=1,this.onSkip()),this.total++,this.persist(),this.multiplier=1+Math.floor(Math.log(this.streak)/Math.log(2))},onToggleScale:function(){this.score=0,this.streak=1,this.total=0,this.hits=0,this.state="idle",this.persist()},onPlayScale:function(e){this.lazyPlayer().playScale(e,{base:0,bpm:this.bpm})},onToggleConfig:function(){this.showConfig=!this.showConfig},lazyPlayer:function(){return this.player||(this.player=new E,this.player.setGain(this.gain)),this.player},persist:function(){var e,t=[],n=Object(L["a"])(this.scales);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.push([a.name,a.active])}}catch(i){n.e(i)}finally{n.f()}localStorage.scales=JSON.stringify(t),localStorage.best=JSON.stringify(this.best),localStorage.gain=JSON.stringify(this.gain),localStorage.melody=JSON.stringify(this.melody),localStorage.bpm=JSON.stringify(this.bpm)}}};n("8a6b");K.render=U,K.__scopeId="data-v-15365caa";var Q=K,X={name:"App",components:{Player:Q}};n("64be");X.render=o;var Z=X,$=Object(a["b"])(Z);$.directive("focus",{mounted:function(e){e.focus()}}),$.mount("#app")},"64be":function(e,t,n){"use strict";n("c894")},"8a6b":function(e,t,n){"use strict";n("cfbc")},c894:function(e,t,n){},cfbc:function(e,t,n){}});
//# sourceMappingURL=app.d0a197af.js.map